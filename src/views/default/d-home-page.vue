<style lang="scss" scoped>
#hero {
  height: 350px;
  background-image: url('../../../public/assets/img/background/ì–´ë‘ìš´ ë°°ê²½.png');
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  //background-attachment: fixed; /* ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ë„ ì´ë¯¸ì§€ëŠ” ê³ ì • */
  color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ ì„¤ì •í•˜ì„¸ìš” (ë°°ê²½ ì´ë¯¸ì§€ì— ëŒ€í•œ ëŒ€ë¹„ë¥¼ ë†’ì´ê¸° ìœ„í•´) */
  text-align: left;

  #hero-title {
    white-space: nowrap;
    margin: 1vw;
    font-size: 1.5rem;
  }

  #hero-sub {
    white-space: nowrap;
    margin: 1vw;
    font-size: 1rem;
    text-decoration: none;
  }
}

.chart-section {
  display: flex;
  justify-content: space-around; // ê°„ê²©ì„ ë„“í˜
  flex-wrap: wrap;
  margin: 0
}

.chart {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border-radius: 10px;
  padding: 20px;
  margin: 20px;
  width: 100%;
  max-width: 600px; // ì°¨íŠ¸ ìµœëŒ€ ë„ˆë¹„ ì¦ê°€
  text-align: center;
}

.canvas-container {
  position: relative;
  height: 0;
  padding-top: 56.25%; // 16:9 ë¹„ìœ¨ ìœ ì§€
  margin-bottom: 30px;
  canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
  }
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
  .chart {
    max-width: 100%; // ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ìµœëŒ€ ë„ˆë¹„ ì¡°ì •
  }
}

.goal-box {
  width: 200px;
  height: 110px;
  background-color: #ffffff;
  border-radius: 10px;
  padding: 20px;
  color: #000000;
  text-align: left;
  margin: 10px 10px 10px 10px;
  border: 1px solid #f0f2f1;
}

.goal-box:hover {
  background-color: rgba(166, 227, 215, 0.99);
  /* ì›í•˜ëŠ” hover ì‹œ ë°°ê²½ ìƒ‰ìƒ */
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ìŠ¤íŠ¸
.img-upload {
  padding: 0 0 0 50px;
  height: 300px;
  text-align: left;

  .up-btn {
    margin-top: 50px;
  }
}

#MultiImageUploader {
  margin-top: 70px;
  max-width: 600px;
}

// ë¹„ë””ì˜¤ ë˜ëŠ” ê·¸ë˜í”½
#mobile-food-icon {
  display: none;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#web-food-icon .video::-webkit-media-controls {
  display: none !important;
}

.video::-webkit-media-controls-enclosure {
  display: none !important;
}

// ëª¨ë°”ì¼ ë²„íŠ¼ ì²˜ìŒì—” ìˆ¨ê¸°ê¸°
#mobile-btn {
  display: none;
  text-align: center;
  margin-top: 50px;
}

/* ëª¨ë°”ì¼ í™˜ê²½ì—ì„œì˜ ìŠ¤íƒ€ì¼ ì ìš© */
@media (max-width: 768px) {
  #hero {
    height: 300px;
    padding: 0 20px;

    // ê¸€ìí¬ê¸° ì‘ê²Œ
    #hero-title {
      white-space: nowrap;
      margin: 1vw;
      font-size: 1.3rem;
    }

    #hero-sub {
      white-space: nowrap;
      margin: 3vw 1vw 1vw;
      font-size: 1rem;
      text-decoration: none;
    }
  }

  .goal-box {
    font-size: 13px;
    width: 140px;
    height: 100px;
    background-color: #ffffff;
    border-radius: 10px;
    padding: 20px;
    color: #000000;
    text-align: left;
    margin: 10px 10px 10px 10px;
    border: 1px solid #f0f2f1;
  }

  // ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ìŠ¤íŠ¸
  .img-upload {
    margin-top: 50px;
    padding: 0 0 0 10px;
    text-align: center;

    .up-btn {
      margin-top: 10px;
    }
  }

  // ëª¨ë°”ì¼ì—ì„  ìŠ¬ë¡¯ë¨¸ì‹  ë³´ì—¬ì£¼ê³  ê·¸ë˜í”½ ìˆ¨ê¸°ê¸°
  #mobile-food-icon {
    display: block;
  }

  #web-food-icon {
    display: none;
  }

  // ë“œë˜ê·¸ì•¤ ë“œë¡­ ìˆ¨ê¸°ê¸°
  #MultiImageUploader {
    display: none;
  }

  // ëŒ€ì‹  ëª¨ë°”ì¼ ì „ìš© ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°
  #mobile-btn {
    display: block;
  }
  .chart {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); // ê·¸ë¦¼ì íš¨ê³¼
  border-radius: 10px; // ë‘¥ê·¼ ëª¨ì„œë¦¬
  background: #fff; // ë°°ê²½ìƒ‰
  padding: 20px;
  margin: 20px;
  width: 100%; // ë„ˆë¹„ ì¡°ì •
  max-width: 450px; // ìµœëŒ€ ë„ˆë¹„ ì„¤ì •
  text-align: center;
}
}

img {
  transition: 0.2s ease-out;
}
</style>
<template>
  <main id="main">

    <!-- ======= Hero Section ======= -->
    <section id="hero" class="hero d-flex align-items-center section-bg">
      <div class="col-12" style="max-width: 1600px; margin: 0 auto;">
        <p data-aos="fade-in" data-aos-duration="1000" class="TheJamsil400" id="hero-title">ê°„í¸í•˜ê²Œ ì´ìš©í•˜ëŠ” ì‹ë‹¨ê´€ë¦¬
          ì†”ë£¨ì…˜,<br>Chat PT</p>
        <p data-aos="fade-in" data-aos-duration="2000" data-aos-delay="100" class="" id="hero-sub"
          style="color: #727070;">
          ê±´ê°•í•œ ì‹ë‹¨ì„ ì°¾ê³  ê³„ì‹  ë‹¹ì‹ ì—ê²Œ
          <br>
          ë§ì¶¤ ì‹ë‹¨ ì „ë¬¸ê°€ê°€ ë˜ì–´ ë“œë¦½ë‹ˆë‹¤.
        </p>
      </div>
    </section>
    <!-- End Hero Section -->

    <!--  ì‹ë‹¨ ì—…ë¡œë“œ  -->
    <section class="ivory" style="padding:0 2vw;">
      <div class="section1800">
        <div class="row " style="margin-top: 100px; margin-bottom:200px; text-align: center;">

          <div class="col-lg-4 col-sm-6" style="height: 300px; text-align: left; " data-aos="fade-in"
            data-aos-duration="1000" data-aos-delay="200">
            <video id="mobile-food-icon" class="video" autoplay loop muted playsinline style="object-fit: contain;">
              <source src="../../assets/img/changeable_diet_minified.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <div style="text-align: center; padding-left: 20px;">
              <!--              <img id="web-food-icon" src="../../assets/img/graphic/taco%201.png"-->
              <!--                   style="margin-left: 20px; object-fit: contain;">-->
              <DynamicImage id="web-food-icon" />
              <!--              <img src="/assets/img/graphic/taco%201.png" style="max-height: 80%; object-fit: contain;">-->
            </div>
          </div>

          <div class="col-lg-8 col-sm-6 img-upload" data-aos="fade-in" data-aos-duration="1000" data-aos-delay="200">
            <h3 id="plz-up" class="TheJamsil400" style=" white-space: nowrap">ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”!</h3>
            <p class="pine_Green_text" style=" white-space: nowrap">ì‚¬ì§„ì„ ì „ë¶€ ë“±ë¡ í•´ì£¼ì‹œë©´ ì €í¬ê°€ ë¶„ë¥˜í•´ë“œë¦´ê²Œìš”.</p>
            <div id="MultiImageUploader">
              <MultiImageUploader />
            </div>
            <div id="mobile-btn">
              <button class="" @click="triggerFileInput">íŒŒì¼ ì„ íƒ</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!--  ì—°ì† ì—…ë¡œë“œ  -->
    <section class="green" style="padding:0 2vw;">
      <div class="section1800" style="height: 300px; padding-top: 50px;">
        <p class="TheJamsil400" data-aos="fade-in" data-aos-duration="2000" data-aos-delay=""
          style="color: #FFFFFF; margin-top: 20px; font-size: 30px;">ì—°ì†
          <span class="TheJamsil400" data-aos="fade-up" data-aos-duration="2000" data-aos-delay="500"
            style="color: #FFFFFF; margin-top: 20px; font-size: 50px;">{{ Consecutive_Dates }}</span>
          ì¼ì§¸
        </p>
        <p class="TheJamsil400" data-aos="fade-in" data-aos-duration="2000" data-aos-delay=""
          style="margin-top: 10px; font-size: 20px; color: #00997b;">ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤ ğŸ˜Š</p>
      </div>
    </section>

    <!--  ì‹ë‹¨ ë¶„ì„  -->
    <section class="lime-green" style="min-height: 100%; height: 100; padding: 30px;">
      <div class="section1800"  >
        <div class="row" style="margin-top: 50px; text-align: center; display: flex;">

          <div style="margin-bottom: 100px;" data-aos="fade-in" data-aos-duration="1000" data-aos-delay="100">
            <span class="material-icons pine_Green_text">bar_chart</span>
            <span id="" class="pine_Green_text TheJamsil400" style="white-space: nowrap; font-size: 1.7rem;">ë‚˜ë§Œì˜ ì‹ìŠµê´€ ë§ì¶¤
              ë¦¬í¬íŠ¸</span>
          </div>
          <div class="chart-section" data-aos="fade-in" data-aos-duration="1000" data-aos-delay="100">
            <div class="chart">
              <p class="TheJamsil400" style="white-space: nowrap; font-size: 1.3rem; margin-bottom: 30px;">ì˜¤ëŠ˜ì˜ ì¹¼ë¡œë¦¬</p>
              <div class="canvas-container">
                <canvas ref="myPieChart"></canvas>
              </div>
              <p class="TheJamsil400">ì¹¼ë¡œë¦¬ : {{ currentCal }} / {{
                recommandCal
              }} (kcal)</p>
            </div>

            <div class="chart">
              <p class="TheJamsil400" style="white-space: nowrap; font-size: 1.3rem; margin-bottom: 30px;">ì˜¤ëŠ˜ì˜ ì˜ì–‘ì†Œ</p>
              <div class="canvas-container">
                <canvas ref="myBarChart"></canvas>
              </div>
              <p class="TheJamsil400">íƒ„ìˆ˜í™”ë¬¼ : {{ currenttan }} / {{
                recommand_tan }} (g)</p>
              <p class="TheJamsil400">ë‹¨ë°±ì§ˆ : {{ currentdan }}/ {{
                recommand_dan
              }} (g)</p>
              <p class="TheJamsil400">ì§€ë°© : {{ currentgi }} / {{ recommand_gi
              }}
                (g)</p>
            </div>
          </div>
        </div><!-- ì‚¬ì§„ ë“±ë¡ -->
      </div>
    </section>

  </main><!-- End #main -->
</template>
<script>
import MultiImageUploader from '@/components/util/img-upload.vue';
import DynamicImage from '@/components/util/dynamic-image.vue';
import { Chart, registerables } from 'chart.js';
Chart.register(...registerables);
export default {
  components: {
    MultiImageUploader,
    DynamicImage,
  },

  data() {
    return {
      // ê¸°ë³¸ì ì¸ ì¹¼ë¡œë¦¬ ë° ì˜ì–‘ì„±ë¶„ ë°ì´í„°ë“¤
      recommandCal: 0,
      recommand_tan: 0,
      recommand_dan: 0,
      recommand_gi: 0,
      currentCal: 0,
      currenttan: 0,
      currentdan: 0,
      currentgi: 0,
      // ì¹¼ë¡œë¦¬ ì°¨íŠ¸ ë°ì´í„° 
      chartData: {

        labels: ['í˜„ì¬ ì¹¼ë¡œë¦¬', 'ë‚¨ì€ ì¹¼ë¡œë¦¬'],

        datasets: [
          {
            data: [0, 0], // ì´ˆê¸° ê°’ìœ¼ë¡œ 0ì„ ì„¤ì •
            backgroundColor: ['rgba(75, 192, 192, 0.5)', '#FFFFFF'],
            borderColor: 'rgba(75, 192, 192, 0.5)', // íŒŒë€ìƒ‰ ê³„ì—´ í…Œë‘ë¦¬
            borderWidth: 1,
          },
        ],
      },
      // ì˜ì–‘ì†Œ ì°¨íŠ¸ ë°ì´í„°
      nutrientData: {
        labels: ['íƒ„ìˆ˜í™”ë¬¼', 'ë‹¨ë°±ì§ˆ', 'ì§€ë°©'],
        datasets: [
          {
            label: 'ì„­ì·¨í•œ ì˜ì–‘ì†Œ',
            data: [], // ì‹¤ì œ ì„­ì·¨ëŸ‰ ë°ì´í„° (ì¶”í›„ ì—…ë°ì´íŠ¸)
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
          },
          {
            label: 'ê¶Œì¥ ì˜ì–‘ì†Œ',
            data: [], // ê¶Œì¥ ì„­ì·¨ëŸ‰ ë°ì´í„°
            backgroundColor: 'rgba(0, 0, 0, 0)', // íˆ¬ëª…í•œ ë°°ê²½ìƒ‰
            borderColor: 'rgba(75, 192, 192,0.8 )', // íŒŒë€ìƒ‰ ê³„ì—´ í…Œë‘ë¦¬
            borderWidth: 1,

            fill: false, // ë‚´ë¶€ ì±„ìš°ê¸° ì—†ìŒ
          }
        ]
      },
      showChart: true, // ì°¨íŠ¸ë¥¼ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€ë¥¼ ì¡°ì •í•˜ëŠ” ë°ì´í„° ì†ì„±
    };
  },
  mounted() {
    if (this.showChart) {
      this.fetchDataAndCreateCharts();
    }
  },

  methods: {
    fetchDataAndCreateCharts() {
      this.$axios.get('/getRecommandDailyTandangi'

      ).then(res => {
        
        this.Consecutive_Dates = res.data.Consecutive_Dates.P_COUNT

        // ì¶”ì²œ ë°ì´í„° ë“±ë¡         
        this.recommandCal = res.data.recommandTandnagi.p_recommand_cal.toFixed(2);
        this.recommand_tan = res.data.recommandTandnagi.p_recommand_tan.toFixed(2);
        this.recommand_dan = res.data.recommandTandnagi.p_recommand_dan.toFixed(2);
        this.recommand_gi = res.data.recommandTandnagi.p_recommand_gi.toFixed(2);
        
        // ì°¨íŠ¸ì— ë³´ì—¬ì§ˆ ê°’ ì´ˆê¸°í™”
        this.currentCal = res.data.totaldaily.dailyTotalCal.toFixed(2);
        this.currenttan = res.data.totaldaily.dailyTotalTan.toFixed(2);
        this.currentdan = res.data.totaldaily.dailyTotalDan.toFixed(2);
        this.currentgi = res.data.totaldaily.dailyTotalGi.toFixed(2);

        if (!this.showChart) {
        return;
      }

        // ì˜ì–‘ì†Œ ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
        this.updateNutritionChartData();
        // ì¹¼ë¡œë¦¬ ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
        this.updateCalChartData();

        this.createCharts();
        this.isLoading = false;
      })
        .catch(error => {
          console.error("ì—ëŸ¬ ë°œìƒ:", error);
        });




    },
    updateCalChartData() {
      // ë‚¨ì€ ì¹¼ë¡œë¦¬ ê³„ì‚°
      let remainingCal = this.recommandCal - this.currentCal;

      // ì°¨íŠ¸ì— í‘œì‹œí•  ë°ì´í„°
      let chartData = [this.currentCal, Math.abs(remainingCal)];

      // ì°¨íŠ¸ ìƒ‰ìƒ ì„¤ì •
      let chartColors = remainingCal < 0 ? ['rgba(75, 192, 192, 0.5)', 'rgba(75, 192, 192, 1.0)'] : ['rgba(75, 192, 192, 0.5)', '#FFFFFF'];
      // ì°¨íŠ¸ì— í‘œì‹œí•  ë°ì´í„°ì™€ ë¼ë²¨
      let chartLabels = remainingCal < 0 ? ['í˜„ì¬ ì¹¼ë¡œë¦¬', 'ì´ˆê³¼ ì¹¼ë¡œë¦¬'] : ['í˜„ì¬ ì¹¼ë¡œë¦¬', 'ë‚¨ì€ ì¹¼ë¡œë¦¬'];

      // ë°ì´í„°ì…‹ ì—…ë°ì´íŠ¸
      this.chartData.datasets[0].data = chartData;
      this.chartData.datasets[0].backgroundColor = chartColors;

      // ë¼ë²¨ ì—…ë°ì´íŠ¸
      this.chartData.labels = chartLabels;
      // ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      this.createCharts();

    },
    updateNutritionChartData() {
      this.nutrientData.datasets[0].data = [this.currenttan, this.currentdan, this.currentgi]; // ì‹¤ì œ ì„­ì·¨í•œ ì˜ì–‘ì†Œ
      this.nutrientData.datasets[1].data = [this.recommand_tan, this.recommand_dan, this.recommand_gi]; // ê¶Œì¥ ì˜ì–‘ì†Œ
    },
    createCharts() {

      // ë°ì´í„°ê°€ ì¤€ë¹„ëœ í›„ì— ì°¨íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      this.$nextTick(() => {
        if (this.myChart) this.myChart.destroy(); // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ íŒŒê´´
        if (this.myNutrientChart) this.myNutrientChart.destroy(); // ê¸°ì¡´ ì˜ì–‘ì†Œ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ íŒŒê´´
        this.createCalChart();
        this.createNutrientChart();
      });
    },
    createCalChart() {
      this.$nextTick(() => {
        if (this.myChart) {
          this.myChart.destroy(); // ì´ë¯¸ ìƒì„±ëœ Chartë¥¼ íŒŒê´´
        }
        const ctxCal = this.$refs.myPieChart.getContext('2d');
        this.myChart = new Chart(ctxCal, {
          type: 'pie',
          data: this.chartData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      });
    },

    createNutrientChart() {
      this.$nextTick(() => {
        const ctxNutrient = this.$refs.myBarChart.getContext('2d');
        if (this.myNutrientChart) this.myNutrientChart.destroy();
        this.myNutrientChart = new Chart(ctxNutrient, {
          type: 'bar',
          data: this.nutrientData,
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
              },
              x: {
                stacked: true, // xì¶•ë„ ìŒ“ì•„ì„œ í‘œì‹œí•©ë‹ˆë‹¤.
              }
            }
          }
        });
      });
    },

  },
  
  beforeUnmount() {
    // í˜ì´ì§€ ì´ë™ ì‹œì— showChart ê°’ì„ falseë¡œ ì„¤ì •í•˜ì—¬ ì°¨íŠ¸ë¥¼ ìˆ¨ê¸°ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    this.showChart = false;
  },




};
</script>